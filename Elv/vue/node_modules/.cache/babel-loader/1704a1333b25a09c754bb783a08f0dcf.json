{"ast":null,"code":"import { ref } from \"vue\";\nimport axios from \"../../axios/axiossetting.js\";\nimport { useRoute, useRouter } from \"vue-router\";\nexport default {\n  props: {\n    parent_id: {\n      type: String,\n      required: false\n    }\n  },\n  emits: ['parent_getSession'],\n\n  setup(props, context) {\n    context.emit(\"parent_getSession\");\n    const fileName = ref(\"\");\n    const board = ref({});\n    let file = '';\n    const router = useRouter();\n    const num = useRoute().params.num;\n    let check = 0;\n\n    const getDetail = async () => {\n      try {\n        console.log(\"num\" + num); //const res = await axios.get(`board/${num}`);\n\n        const res = await axios.get('boards/' + num);\n        console.log(res.data);\n        board.value = res.data.board;\n\n        if (board.value == null) {\n          console.log('null입니다.');\n          router.push(\"{name:'404'}\");\n          return;\n        } //\"board_ORIGINAL\" :null로 전송된 경우 fileName.value=null입니다.\n\n\n        fileName.value = board.value.board_ORIGINAL;\n        console.log(\"파일이름 = \" + fileName.value);\n        board.value.board_PASS = \"\";\n      } catch (err) {\n        console.log(err);\n      }\n    };\n\n    getDetail();\n\n    const change = event => {\n      file = event.target.files[0];\n      fileName.value = file.name;\n      check++;\n    };\n\n    const update = async () => {\n      let frm = new FormData();\n\n      if (file != '') {\n        //let file=''; 초기값 상태가 아닌지 확인합니다.\n        frm.append(\"updatefile\", file);\n      }\n\n      frm.append(\"BOARD_CONTENT\", board.value.baord_SUBJECT);\n      frm.append(\"BOARD_PASS\", board.value.baord_PASS);\n      frm.append(\"BOARD_NAME\", board.value.baord_NAME);\n      frm.append(\"BOARD_NUM\", num);\n\n      if (check == 0 && fileName.value != null) {\n        frm.append(\"check\", fileName.value);\n        frm.append(\"BOARD_FILE\", baord.value.board_FILE);\n      }\n\n      try {\n        const res = await axios.patch('boards', frm, {\n          headers: {\n            'Content-Type': 'multipart/form-data;charset=UTF-8'\n          }\n        });\n        console.log(`수정 응답 : ${res.data}`);\n\n        if (res.data == \"Nopass\") {\n          alert(\"비밀번호를 확인하세요\");\n        } else if (res.data == \"success\") {\n          router.push({\n            name: 'Board_Detail'\n          });\n        } else if (res.data == \"fail\") {\n          console.log('수정 실패입니다.');\n        }\n      } catch (err) {\n        console.log(\"여기는 오류\");\n        console.log(err);\n      }\n    }; //update\n\n\n    const remove = () => {\n      fileName.value = '';\n    };\n\n    const goDetail = () => {\n      router.push({\n        name: 'Board_Detail'\n      });\n    };\n\n    return {\n      fileName,\n      board,\n      update,\n      change,\n      remove,\n      goDetail\n    };\n  }\n\n};","map":{"version":3,"mappings":"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","names":["ref","axios","useRoute","useRouter","props","parent_id","type","String","required","emits","setup","context","emit","fileName","board","file","router","num","params","check","getDetail","console","log","res","get","data","value","push","board_ORIGINAL","board_PASS","err","change","event","target","files","name","update","frm","FormData","append","baord_SUBJECT","baord_PASS","baord_NAME","baord","board_FILE","patch","headers","alert","remove","goDetail"],"sourceRoot":"","sources":["C:\\vue_project\\vue3-first\\src\\ex18_component_store\\component\\board\\board_update.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <form @submit.prevent=\"update\">\r\n        <h1>MVC 게시판-update 페이지</h1>\r\n        <div class=\"form-group\">\r\n            <label for=\"board_name\">글쓴이</label>\r\n            <input \r\n                    readonly \r\n                    :value=\"board.board_NAME\" \r\n                    type=\"text\"\r\n                    maxlength=\"30\" \r\n                    class=\"form-control\">\r\n        </div>\r\n\r\n        <div class=\"form-group\">\r\n            <label for=\"board_subject\">제목</label>\r\n            <input \r\n                  type=\"text\" \r\n                  v-model.lazy=\"board.board_SUBJECT\" \r\n                  required\r\n                  maxlength=\"100\" \r\n                  class=\"form-control\" \r\n                  placeholder=\"Enter board_subject\">\r\n        </div>\r\n\r\n        <div class=\"form-group\">\r\n            <label for=\"board_content\">내용</label>\r\n            <textarea \r\n                    v-model.lazy=\"board.board_CONTENT\"\r\n                    required\r\n                    rows=\"10\" \r\n                    class=\"form-control\"></textarea>\r\n        </div>\r\n\r\n        <div class=\"form-group\" v-if=\"board.board_RE_LEV==0\">\r\n            <label for=\"board_file\">파일 첨부</label>\r\n            <label>\r\n            <img src=\"../../assets/attach.png\" alt=\"파일첨부\">\r\n                <input \r\n                    type=\"file\"  name=\"uploadfile\"  v-show=\"false\"  @change=\"change\">\r\n            </label>\r\n            <span>{{fileName}}</span>\r\n            <img src=\"../../assets/remove.png\" alt=\"파일삭제\" class=\"remove\"\r\n                    v-if=\"fileName\"\r\n                    @click=\"remove\">\r\n        </div>\r\n\r\n        <div class=\"form-group\">\r\n        <label for=\"board_pass\">비밀번호</label>\r\n            <input \r\n                    type=\"password\"\r\n                    v-model.lazy=\"board.baord_PASS\" \r\n                    maxlength=\"30\" \r\n                    required\r\n                    placeholder=\"Enter board_pass\"\r\n                    class=\"form-control\">\r\n        </div>\r\n\r\n        <div class=\"form-group\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">수정</button>\r\n            <button type=\"reset\" class=\"btn btn-danger\"  @click=\"goDetail\">취소</button>\r\n        </div>\r\n    </form>\r\n </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref } from \"vue\";\r\nimport axios from \"../../axios/axiossetting.js\";\r\nimport {useRoute, useRouter} from \"vue-router\";\r\nexport default {\r\n    props:{\r\n        parent_id:{\r\n            type:String,\r\n            required:false\r\n        }\r\n    },\r\n    emits:['parent_getSession'],\r\n    setup(props, context){\r\n        context.emit(\"parent_getSession\");\r\n\r\n        const fileName=ref(\"\");\r\n        const board = ref({});\r\n        let file = '';\r\n        const router = useRouter();\r\n        const num = useRoute().params.num;\r\n        let check=0;\r\n\r\n        const getDetail = async ()=>{\r\n            try{\r\n                    console.log(\"num\"+num);\r\n                    //const res = await axios.get(`board/${num}`);\r\n                    const res = await axios.get('boards/'+num);\r\n                    console.log(res.data);\r\n                    board.value = res.data.board;\r\n                    if(board.value == null){\r\n                        console.log('null입니다.');\r\n                        router.push(\"{name:'404'}\")\r\n                        return;\r\n                    }\r\n                    //\"board_ORIGINAL\" :null로 전송된 경우 fileName.value=null입니다.\r\n                    fileName.value=board.value.board_ORIGINAL;\r\n                    console.log(\"파일이름 = \"+fileName.value);\r\n\r\n                    board.value.board_PASS=\"\";\r\n            }catch(err){\r\n                console.log(err)\r\n            }\r\n        }\r\n\r\n        getDetail();\r\n\r\n        const change = event =>{\r\n            file=event.target.files[0];\r\n            fileName.value = file.name;\r\n            check++;\r\n        }\r\n\r\n        const update = async()=>{\r\n            let frm=new FormData();\r\n            if(file!=''){//let file=''; 초기값 상태가 아닌지 확인합니다.\r\n                frm.append(\"updatefile\",file);\r\n            }\r\n            frm.append(\"BOARD_CONTENT\",board.value.baord_SUBJECT);\r\n            frm.append(\"BOARD_PASS\",board.value.baord_PASS);\r\n            frm.append(\"BOARD_NAME\",board.value.baord_NAME);\r\n            frm.append(\"BOARD_NUM\",num);\r\n\r\n            if(check==0 && fileName.value != null){\r\n                frm.append(\"check\", fileName.value);\r\n                frm.append(\"BOARD_FILE\", baord.value.board_FILE);\r\n            }\r\n\r\n            try{\r\n                    const res = await axios.patch('boards',\r\n                    frm\r\n                        ,\r\n                        { headers : \r\n                                { 'Content-Type' : 'multipart/form-data;charset=UTF-8' }        \r\n                        }\r\n                    );\r\n\r\n                    console.log(`수정 응답 : ${res.data}`);\r\n                    if(res.data==\"Nopass\"){\r\n                        alert(\"비밀번호를 확인하세요\");\r\n                    }else if(res.data==\"success\"){\r\n                        router.push({name : 'Board_Detail'});\r\n                    }else if(res.data==\"fail\"){\r\n                        console.log('수정 실패입니다.');\r\n                    }\r\n           }catch(err){\r\n            console.log(\"여기는 오류\");\r\n            console.log(err);\r\n           }\r\n        }//update\r\n        \r\n        const remove=()=>{\r\n            fileName.value='';\r\n        }\r\n        const goDetail=()=>{\r\n            router.push({name:'Board_Detail'})\r\n        }\r\n\r\n        return{\r\n                fileName, board,\r\n                update, change, remove, goDetail\r\n        }\r\n    }\r\n\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n    .remove{\r\n      width:10px;\r\n      position:relative;\r\n      top:-10px;\r\n    }\r\n    img {\r\n      width: 20px;\r\n    }\r\n    button {\r\n      margin-right: 1em;\r\n    }\r\n    textarea{\r\n      resize: none;\r\n    }\r\n    </style>\r\n    \r\n"]},"metadata":{},"sourceType":"module"}